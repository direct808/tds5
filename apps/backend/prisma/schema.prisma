generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

generator kysely {
  provider = "prisma-kysely"
  output   = "../generated"
  fileName = "kysely.ts"
}

datasource db {
  provider = "postgresql"
}

model AffiliateNetwork {
  id          String    @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String
  offerParams String?
  userId      String    @db.Uuid
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt @db.Timestamptz()
  deletedAt   DateTime? @db.Timestamptz()
  user        User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  offer       Offer[]

  @@index([userId])
  @@index([deletedAt])
  @@map("affiliate_network")
}

model Domain {
  id                  String     @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                String
  indexPageCampaign   Campaign?  @relation(name: "IndexPage", fields: [indexPageCampaignId], references: [id])
  indexPageCampaignId String?    @db.Uuid
  intercept404        Boolean    @default(false)
  campaigns           Campaign[]
  user                User       @relation(fields: [userId], references: [id])
  userId              String     @db.Uuid
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt @db.Timestamptz()
  deletedAt           DateTime?  @db.Timestamptz()

  @@unique([name])
  @@index([userId])
  @@index([deletedAt])
  @@map("domain")
}

model Campaign {
  id               String    @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String    @db.VarChar
  code             String    @unique() @db.VarChar
  domainId         String?   @db.Uuid
  domain           Domain?   @relation(fields: [domainId], references: [id])
  indexPageDomains Domain[]  @relation("IndexPage")
  sourceId         String?   @db.Uuid
  active           Boolean
  userId           String    @db.Uuid
  createdAt        DateTime  @default(now()) @db.Timestamptz()
  updatedAt        DateTime  @updatedAt @db.Timestamptz()
  deletedAt        DateTime? @db.Timestamptz()
  user             User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  source           Source?   @relation(fields: [sourceId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  streams          Stream[]  @relation("StreamCampaign")
  actionStreams    Stream[]  @relation("StreamActionCampaign")

  @@index([userId])
  @@index([deletedAt])
  @@map("campaign")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model Click {
  id                 String       @id() @db.Char(12)
  visitorId          String       @db.Char(6)
  campaignId         String       @db.Uuid
  previousCampaignId String?      @db.Uuid
  offerId            String?      @db.Uuid
  affiliateNetworkId String?      @db.Uuid
  sourceId           String?      @db.Uuid
  streamId           String?      @db.Uuid
  destination        String?
  isUniqueGlobal     Boolean?
  isUniqueCampaign   Boolean?
  isUniqueStream     Boolean?
  isProxy            Boolean?
  country            String?
  region             String?
  city               String?
  ip                 String?      @db.Inet
  referer            String?
  userAgent          String?
  language           String?      @db.Char(2)
  isBot              Boolean?
  deviceType         String?
  os                 String?
  osVersion          String?
  browser            String?
  browserVersion     String?
  deviceModel        String?
  keyword            String?
  source             String?
  cost               Decimal?     @db.Decimal(12, 2)
  externalId         String?
  creativeId         String?
  adCampaignId       String?
  subId1             String?
  subId2             String?
  extraParam1        String?
  extraParam2        String?
  createdAt          DateTime     @default(now()) @db.Timestamptz()
  conversions        Conversion[]

  @@index([campaignId])
  @@index([previousCampaignId])
  @@index([offerId])
  @@index([affiliateNetworkId])
  @@index([sourceId])
  @@index([streamId])
  @@index([destination])
  @@index([isUniqueGlobal])
  @@index([isUniqueCampaign])
  @@index([isUniqueStream])
  @@index([isProxy])
  @@index([country])
  @@index([region])
  @@index([city])
  @@index([ip])
  @@index([referer])
  @@index([userAgent])
  @@index([language])
  @@index([isBot])
  @@index([deviceType])
  @@index([os])
  @@index([osVersion])
  @@index([browser])
  @@index([browserVersion])
  @@index([deviceModel])
  @@index([keyword])
  @@index([source])
  @@index([externalId])
  @@index([creativeId])
  @@index([adCampaignId])
  @@index([subId1])
  @@index([subId2])
  @@index([extraParam1])
  @@index([extraParam2])
  @@map("click")
}

model Conversion {
  id             String   @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  originalStatus String?
  clickId        String   @db.Char(12)
  params         Json?
  status         String
  previousStatus String?
  revenue        Decimal? @db.Decimal(12, 2)
  createdAt      DateTime @default(now()) @db.Timestamptz()
  tid            String?  @db.VarChar(100)
  click          Click    @relation(fields: [clickId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([clickId, tid])
  @@index([clickId])
  @@map("conversion")
}

model Offer {
  id                 String            @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String
  url                String
  affiliateNetworkId String?           @db.Uuid
  userId             String            @db.Uuid
  createdAt          DateTime          @default(now()) @db.Timestamptz()
  updatedAt          DateTime          @updatedAt @db.Timestamptz()
  deletedAt          DateTime?         @db.Timestamptz()
  affiliateNetwork   AffiliateNetwork? @relation(fields: [affiliateNetworkId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user               User              @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  streamOffers       StreamOffer[]

  @@index([userId])
  @@index([deletedAt])
  @@map("offer")
}

model Source {
  id        String     @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  userId    String     @db.Uuid
  createdAt DateTime   @default(now()) @db.Timestamptz()
  updatedAt DateTime   @updatedAt @db.Timestamptz()
  deletedAt DateTime?  @db.Timestamptz()
  campaign  Campaign[]
  user      User       @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([userId])
  @@index([deletedAt])
  @@map("source")
}

model Stream {
  id               String                  @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String                  @db.VarChar
  campaignId       String                  @db.Uuid
  schema           StreamSchemaEnum
  redirectType     StreamRedirectTypeEnum?
  redirectUrl      String?
  actionType       StreamActionTypeEnum?
  actionCampaignId String?                 @db.Uuid
  actionContent    String?
  filters          Json?
  deletedAt        DateTime?               @db.Timestamptz()
  actionCampaign   Campaign?               @relation("StreamActionCampaign", fields: [actionCampaignId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  campaign         Campaign                @relation("StreamCampaign", fields: [campaignId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  streamOffers     StreamOffer[]

  @@index([campaignId])
  @@index([deletedAt])
  @@map("stream")
}

model StreamOffer {
  id       String  @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  offerId  String  @db.Uuid
  percent  Int     @db.SmallInt
  active   Boolean
  streamId String  @db.Uuid
  offer    Offer   @relation(fields: [offerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  stream   Stream  @relation(fields: [streamId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([offerId, streamId])
  @@map("stream_offer")
}

model User {
  id                String             @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email             String             @unique()
  password          String
  createdAt         DateTime           @default(now()) @db.Timestamptz()
  updatedAt         DateTime           @updatedAt @db.Timestamptz()
  deletedAt         DateTime?          @db.Timestamptz()
  affiliateNetworks AffiliateNetwork[]
  campaigns         Campaign[]
  offers            Offer[]
  sources           Source[]
  domains           Domain[]

  @@map("user")
}

enum StreamActionTypeEnum {
  NOTHING
  SHOW404
  SHOW_HTML
  SHOW_TEXT
  TO_CAMPAIGN

  @@map("stream_action_type_enum")
}

enum StreamRedirectTypeEnum {
  CURL
  FORM_SUBMIT
  HTTP
  IFRAME
  JS
  META
  META2
  REMOTE
  WITHOUT_REFERER

  @@map("stream_redirect_type_enum")
}

enum StreamSchemaEnum {
  ACTION
  DIRECT_URL
  LANDINGS_OFFERS

  @@map("stream_schema_enum")
}
